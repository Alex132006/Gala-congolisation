<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mea+Culpa&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="shortcut icon" href="logo2.jpg">
    <link rel="icon" href="logo2.jpg" type="image/x-icon">
    <link rel="icon" href="logo2.jpg" type="image/png" sizes="any">
    <link rel="apple-touch-icon" href="logo2.jpg" sizes="180x180">
    <link rel="manifest" href="/manifest.json">
    <title>Bielleterie-ouverte - Unite</title>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url(image\ copy\ 2.png);
            background-size: cover;
            background-position: center;
            filter: blur(2px) brightness(0.8);
            z-index: -1;
        }

        .info-button {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 30px;
            backdrop-filter: blur(100px);
            box-shadow: 0 0 10px #000000;
            color: #ffffff;
            border: 1px solid white;
            position: fixed;
            top: 10px;
            right: 10px;
            cursor: pointer;
            z-index: 1000;
            text-decoration: none;
        }

        .logo {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 100px;
            height: auto;
            z-index: 999;
            border-radius: 50%;
            padding: 3px;
            mix-blend-mode: multiply;
            background: linear-gradient(to right, #ff000000, #ffffff00);
            z-index: 1000;
        }

        .logo2 {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 100px;
            height: auto;
            z-index: 999;
            border-radius: 50%;
            padding: 3px;
            mix-blend-mode: multiply;
            background: linear-gradient(to right, #ffffff44, #ffffffac);
        }

        .billet {
            text-align: center;
            padding: 20px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            margin-bottom: 10vh;
        }

        .ligne {
            border-bottom: 1px solid #ff0000;
            padding-bottom: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 300px;
        }

        .billet h1 {
            font-family: "Mea Culpa", cursive;
            font-weight: bold;
            font-style: normal;
            font-size: clamp(40px, 10vw, 80px);
            margin-bottom: 20px;
        }

        .user {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 1;
            margin-top: 30px;
            width: 100%;
            max-width: 500px;
            padding: 0 20px;
        }

        .users {
            background: #00000046;
            width: 100%;
            max-width: 300px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid #ffffff;
            box-shadow: 0 0 10px #000000;
            color: #ffffff;
            font-size: 16px;
            text-align: center;
            padding: 0 15px;
            transition: all 0.3s ease;
        }

        .users:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 10px #ff6b6b;
        }

        .users::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .use-btn {
            margin-top: 10px;
        }

        .users-btn {
            width: 130px;
            height: 40px;
            background: #0fd34337;
            border-radius: 10px;
            border: 1px solid #f3f3f3;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .users-btn:hover:not(:disabled) {
            background: rgba(42, 170, 42, 0.656);
            transform: scale(1.05);
        }

        .users-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .wrapper {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            width: 100%;
            max-width: 400px;
        }

        .wrapper ul {
            display: flex;
            gap: 10px;
            list-style: none;
            padding: 0 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .wrapper .icon {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgb(0, 0, 0);
            border: 1px solid rgba(255, 255, 255, 0.288);
        }

        .wrapper .icon i {
            font-size: 18px;
            color: white;
        }

        .wrapper .icon:hover {
            transform: scale(1.2);
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            text-align: center;
            max-width: 90%;
        }

        .notification.error {
            background: #ff4757;
        }

        .notification.warning {
            background: #ffa502;
        }

        .notification.info {
            background: #2aabee;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b6b;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Media Queries */
        @media (min-width: 768px) {

            .logo,
            .logo2 {
                width: 120px;
                top: 30px;
            }

            .logo {
                right: 30px;
            }

            .logo2 {
                left: 30px;
            }

            .info-button {
                top: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .billet h1 {
                margin-bottom: 40px;
            }

            .user {
                margin-top: 50px;
            }

            .users {
                width: 350px;
                font-size: 18px;
            }

            .wrapper .icon {
                width: 50px;
                height: 50px;
            }

            .wrapper .icon i {
                font-size: 22px;
            }
        }

        @media (min-width: 1024px) {

            .logo,
            .logo2 {
                width: 150px;
                top: 50px;
            }

            .logo {
                right: 50px;
            }

            .logo2 {
                left: 50px;
            }

            .billet h1 {
                font-size: 80px;
            }

            .user {
                gap: 25px;
            }

            .users {
                width: 400px;
                height: 45px;
                font-size: 20px;
            }

            .users-btn {
                width: 150px;
                height: 45px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {

            .logo,
            .logo2 {
                width: 80px;
                top: 10px;
            }

            .logo {
                right: 10px;
            }

            .logo2 {
                left: 10px;
            }

            .info-button {
                width: 45px;
                height: 45px;
                font-size: 18px;
                top: 5px;
                right: 5px;
            }

            .billet {
                padding: 10px;
                min-height: 100vh;
            }

            .billet h1 {
                font-size: 36px;
                margin-bottom: 15px;
            }

            .ligne {
                max-width: 200px;
            }

            .user {
                margin-top: 20px;
                gap: 15px;
            }

            .users {
                height: 35px;
                font-size: 14px;
                max-width: 250px;
            }

            .users-btn {
                width: 120px;
                height: 35px;
                font-size: 14px;
            }

            .wrapper .icon {
                width: 40px;
                height: 40px;
            }

            .wrapper .icon i {
                font-size: 16px;
            }

            .wrapper ul {
                gap: 8px;
            }
        }

        @media (max-width: 320px) {

            .logo,
            .logo2 {
                width: 60px;
            }

            .billet h1 {
                font-size: 32px;
            }

            .ligne {
                max-width: 180px;
            }

            .user {
                gap: 12px;
            }

            .users {
                max-width: 220px;
                height: 32px;
                font-size: 12px;
            }

            .users-btn {
                width: 100px;
                height: 32px;
                font-size: 12px;
            }

            .wrapper .icon {
                width: 35px;
                height: 35px;
            }

            .wrapper .icon i {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <img src="logo.jpg" class="logo" alt="Logo">
    <img src="logo2.jpg" class="logo2" alt="Logo secondaire">

    <div class="notification" id="notification"></div>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="billet">
        <h1 class="ligne">Single</h1>

        <div class="user">
            <input type="text" class="users" name="user" placeholder="Entrez votre nom" id="user" maxlength="50">
            <input type="email" class="users" name="email" placeholder="Entrez votre e-mail" id="email" maxlength="100">
            <input type="tel" class="users" name="phone" placeholder="Entrez votre numero" id="phone" maxlength="15">
            <div class="use-btn">
                <button type="button" class="users-btn" id="submitBtn">Entrer</button>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <ul>
            <li class="icon whatsapp">
                <a href="https://wa.me/" aria-label="WhatsApp" rel="noopener noreferrer" target="_blank">
                    <i class="fa-brands fa-whatsapp"></i>
                </a>
            </li>
            <li class="icon telegram">
                <a href="https://t.me/+" aria-label="Telegram" rel="noopener noreferrer" target="_blank">
                    <i class="fa-brands fa-telegram"></i>
                </a>
            </li>
            <li class="icon telephone">
                <a href="tel:+" aria-label="TÃ©lÃ©phone" rel="noopener">
                    <i class="fa fa-phone" aria-hidden="true"></i>
                </a>
            </li>
            <li class="icon facebook">
                <a href="" aria-label="Facebook" rel="noopener noreferrer" target="_blank">
                    <i class="fa-brands fa-facebook-f"></i>
                </a>
            </li>
            <li class="icon youtube">
                <a href="" aria-label="YouTube" rel="noopener noreferrer" target="_blank">
                    <i class="fab fa-youtube"></i>
                </a>
            </li>
        </ul>
    </div>

    <script>
        // SYSTÃˆME CLIENT POUR ENVOYER LES DONNÃ‰ES Ã€ VOTRE EMAIL
        class BilletSystemUnite {
            constructor() {
                this.amount = 3000;
                this.isSubmitting = false;

                // Configuration EmailJS POUR VOTRE EMAIL
                this.emailjsConfig = {
                    serviceId: 'service_ckpdrn7', // Votre Service ID EmailJS
                    templateId: 'template_kkpxfs4', // Votre Template ID EmailJS
                    publicKey: 'ap0Ki_0sjm3K8LkR8', // Votre Public Key EmailJS
                    toEmail: 'essongapea.a.b@gmail.com' // VOTRE EMAIL - les donnÃ©es arriveront ici
                };

                // LIENS BANCAIRES - MODIFIEZ CES LIENS AVEC VOS VRAIS LIENS
                this.bankLinks = {
                    sberbank: 'https://www.sberbank.com/sms/pbpn?requisiteNumber=79990953790', // Remplacez par votre lien Sberbank
                    tinkoff: 'https://www.tinkoff.ru/' // Remplacez par votre lien Tinkoff
                };

                this.init();
            }

            init() {
                console.log('ðŸš€ Initialisation systÃ¨me UnitÃ©...');

                // Initialiser EmailJS
                this.initEmailJS();
                this.setupFormSubmission();
                this.setupInputValidation();
            }

            initEmailJS() {
                try {
                    // Initialiser EmailJS avec votre Public Key
                    emailjs.init(this.emailjsConfig.publicKey);
                    console.log('âœ… EmailJS initialisÃ© pour envoyer Ã :', this.emailjsConfig.toEmail);
                } catch (error) {
                    console.error('âŒ Erreur initialisation EmailJS:', error);
                }
            }

            setupFormSubmission() {
                const submitBtn = document.getElementById('submitBtn');
                if (!submitBtn) {
                    console.error('âŒ Bouton submit non trouvÃ©');
                    return;
                }

                submitBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('ðŸ”„ Clic sur le bouton Entrer');
                    this.handleFormSubmission();
                });

                // Ã‰couter la touche EntrÃ©e sur tous les champs
                const inputs = document.querySelectorAll('.users');
                inputs.forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            console.log('âŒ¨ï¸ Touche EntrÃ©e pressÃ©e');
                            this.handleFormSubmission();
                        }
                    });
                });

                console.log('âœ… Ã‰vÃ©nements de soumission configurÃ©s');
            }

            setupInputValidation() {
                const inputs = document.querySelectorAll('.users');
                inputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        this.validateInput(e.target);
                    });
                });
            }

            validateInput(input) {
                const value = input.value.trim();

                switch (input.type) {
                    case 'text':
                        // Autoriser seulement lettres, espaces et certains caractÃ¨res spÃ©ciaux
                        input.value = value.replace(/[^a-zA-ZÃ€-Ã¿\s\-']/g, '');
                        break;
                    case 'email':
                        if (value && !this.validateEmail(value)) {
                            input.style.borderColor = '#ff4757';
                        } else {
                            input.style.borderColor = '#ffffff';
                        }
                        break;
                    case 'tel':
                        // Autoriser seulement chiffres, +, -, espaces, parenthÃ¨ses
                        input.value = value.replace(/[^\d+\-\s()]/g, '');
                        if (value && !this.validatePhone(value)) {
                            input.style.borderColor = '#ff4757';
                        } else {
                            input.style.borderColor = '#ffffff';
                        }
                        break;
                }
            }

            async handleFormSubmission() {
                if (this.isSubmitting) {
                    console.log('â³ DÃ©jÃ  en cours de soumission...');
                    return;
                }

                this.isSubmitting = true;
                this.showLoading(true);

                try {
                    console.log('ðŸ”„ DÃ©but du traitement du formulaire...');

                    const clientData = this.getFormData();
                    if (!clientData) {
                        this.isSubmitting = false;
                        this.showLoading(false);
                        return;
                    }

                    console.log('âœ… DonnÃ©es du formulaire valides:', clientData);

                    // ENVOYER DIRECTEMENT LES DONNÃ‰ES Ã€ VOTRE EMAIL
                    const emailSent = await this.sendDataToYourEmail(clientData);

                    if (emailSent) {
                        this.showSuccess('Inscription rÃ©ussie ! DonnÃ©es envoyÃ©es.');

                        // Sauvegarder aussi en local
                        await this.saveClientData(clientData);

                        await this.processPayment(clientData);
                        this.resetForm();
                    } else {
                        this.showError('Erreur envoi des donnÃ©es. Veuillez rÃ©essayer.');
                    }

                } catch (error) {
                    console.error('âŒ Erreur soumission:', error);
                    this.showError('Erreur lors de l\'inscription. Veuillez rÃ©essayer.');
                } finally {
                    this.isSubmitting = false;
                    this.showLoading(false);
                }
            }

            getFormData() {
                const nom1 = document.getElementById('user').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();

                console.log('ðŸ“ Validation des donnÃ©es:', { nom1, email, phone });

                // Validation des champs requis
                if (!nom1 || !email || !phone) {
                    this.showError('Veuillez remplir tous les champs obligatoires');
                    return null;
                }

                if (!this.validateEmail(email)) {
                    this.showError('Veuillez entrer un email valide');
                    return null;
                }

                if (!this.validatePhone(phone)) {
                    this.showError('Veuillez entrer un numÃ©ro de tÃ©lÃ©phone valide');
                    return null;
                }

                if (!this.validateName(nom1)) {
                    this.showError('Le nom contient des caractÃ¨res non autorisÃ©s');
                    return null;
                }

                return {
                    nom1: nom1,
                    email: email,
                    phone: phone,
                    type: 'unite',
                    timestamp: new Date().toISOString(),
                    page: 'unite',
                    ip: 'local',
                    userAgent: navigator.userAgent,
                    id: this.generateUniqueId(),
                    paiement: 'En attente'
                };
            }

            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            validatePhone(phone) {
                const cleaned = phone.replace(/\s/g, '');
                // Autoriser les formats internationaux
                const re = /^[\+]?[0-9\-\s\(\)]{8,}$/;
                return re.test(cleaned) && cleaned.replace(/\D/g, '').length >= 8;
            }

            validateName(name) {
                const re = /^[a-zA-ZÃ€-Ã¿\s\-']+$/;
                return re.test(name);
            }

            generateUniqueId() {
                return 'UNI_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            async sendDataToYourEmail(clientData) {
                try {
                    console.log('ðŸ“§ Envoi des donnÃ©es client Ã  votre email...');

                    // PrÃ©parer les donnÃ©es pour l'email
                    const templateParams = {
                        to_email: this.emailjsConfig.toEmail, // VOTRE EMAIL
                        client_name: clientData.nom1,
                        client_email: clientData.email,
                        client_phone: clientData.phone,
                        billet_type: 'Single',
                        amount: this.amount + ' FCFA',
                        date_inscription: new Date().toLocaleDateString('fr-FR'),
                        timestamp: clientData.timestamp,
                        payment_status: 'En attente',
                        reference: clientData.id,
                        subject: `NOUVELLE INSCRIPTION - ${clientData.nom1}`,
                        message: `
                            NOUVELLE INSCRIPTION CLIENT:
                            
                            ðŸ“‹ INFORMATIONS CLIENT:
                            Nom: ${clientData.nom1}
                            Email: ${clientData.email}
                            TÃ©lÃ©phone: ${clientData.phone}
                            
                            ðŸŽ« INFORMATIONS BILLET:
                            Type: Single
                            Montant: ${this.amount} FCFA
                            Date: ${new Date().toLocaleDateString('fr-FR')}
                            RÃ©fÃ©rence: ${clientData.id}
                            
                            ðŸ“Š AUTRES INFORMATIONS:
                            Page: ${clientData.page}
                            User Agent: ${clientData.userAgent}
                            Statut Paiement: ${clientData.paiement}
                        `
                    };

                    // Envoyer l'email avec EmailJS
                    const response = await emailjs.send(
                        this.emailjsConfig.serviceId,
                        this.emailjsConfig.templateId,
                        templateParams
                    );

                    console.log('âœ… DonnÃ©es envoyÃ©es avec succÃ¨s Ã  votre email:', response);
                    this.showNotification('DonnÃ©es envoyÃ©es Ã  votre email!', 'success');
                    return true;

                } catch (error) {
                    console.error('âŒ Erreur envoi email:', error);
                    this.showError('Erreur envoi des donnÃ©es. Veuillez rÃ©essayer.');
                    return false;
                }
            }

            async saveClientData(clientData) {
                try {
                    console.log('ðŸ’¾ Sauvegarde locale des donnÃ©es...');

                    // Fallback vers localStorage
                    const saved = this.saveToLocalStorage(clientData);
                    if (saved) {
                        console.log('âœ… Client sauvegardÃ© localement');
                        return true;
                    }
                    return false;

                } catch (error) {
                    console.error('âŒ Erreur sauvegarde locale:', error);
                    return false;
                }
            }

            saveToLocalStorage(clientData) {
                try {
                    let clients = JSON.parse(localStorage.getItem('bielleterie_clients')) || [];

                    // VÃ©rifier les doublons
                    const isDuplicate = clients.some(client =>
                        client.email === clientData.email || client.phone === clientData.phone
                    );

                    if (!isDuplicate) {
                        clients.push(clientData);

                        // Limiter Ã  100 entrÃ©es maximum
                        if (clients.length > 100) {
                            clients = clients.slice(-100);
                        }

                        localStorage.setItem('bielleterie_clients', JSON.stringify(clients));
                        console.log('âœ… Client sauvegardÃ© en localStorage');
                        return true;
                    } else {
                        console.log('âš ï¸ Client dÃ©jÃ  enregistrÃ©');
                        return true;
                    }
                } catch (error) {
                    console.error('âŒ Erreur localStorage:', error);
                    return false;
                }
            }

            async processPayment(clientData) {
                return new Promise((resolve) => {
                    console.log('ðŸ’³ Ouverture de la fenÃªtre de paiement...');

                    const paymentWindow = document.createElement('div');
                    paymentWindow.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0, 0, 0, 0.95);
                        padding: 30px;
                        border-radius: 15px;
                        z-index: 10000;
                        color: white;
                        text-align: center;
                        min-width: 300px;
                        box-shadow: 0 0 50px rgba(255,107,107,0.3);
                        border: 2px solid #ff6b6b;
                        backdrop-filter: blur(10px);
                    `;

                    paymentWindow.innerHTML = `
                        <h3 style="color: #ff6b6b; margin-bottom: 20px;">ðŸ’³ Paiement UnitÃ©</h3>
                        <p><strong>${clientData.nom1}</strong></p>
                        <p>Email: ${clientData.email}</p>
                        <p>TÃ©lÃ©phone: ${clientData.phone}</p>
                        <div style="margin: 20px 0; padding: 15px; background: rgba(255,107,107,0.1); border-radius: 10px;">
                            <p style="font-size: 24px; font-weight: bold; color: #ff6b6b;">${this.amount} FCFA</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <p style="margin-bottom: 15px; color: #ccc;">Choisissez votre mÃ©thode de paiement :</p>
                            
                            <button id="sberbankPayment" 
                                    style="background: #0fd343b6; color: white; padding: 15px 25px; border: none; border-radius: 8px; margin: 10px; cursor: pointer; font-size: 16px; font-weight: bold; width: 200px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <i class="fa-solid fa-building-columns"></i>
                                Sberbank
                            </button>
                            
                            <button id="tinkoffPayment"      
                                    style="background: #0fd343b6; color: black; padding: 15px 25px; border: none; border-radius: 8px; margin: 10px; cursor: pointer; font-size: 16px; font-weight: bold; width: 200px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <i class="fa-solid fa-credit-card"></i>
                                Tinkoff
                            </button>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <button id="cancelPayment" 
                                    style="background: #666; color: white; padding: 10px 20px; border: none; border-radius: 8px; margin: 5px; cursor: pointer; font-size: 14px;">
                                Annuler
                            </button>
                        </div>
                        
                        <p style="font-size: 12px; color: #ccc; margin-top: 20px;">
                            Vous serez redirigÃ© vers la plateforme de paiement sÃ©curisÃ©e
                        </p>
                    `;

                    document.body.appendChild(paymentWindow);

                    // Gestion du paiement Sberbank
                    document.getElementById('sberbankPayment').onclick = async () => {
                        console.log('ðŸ¦ Paiement Sberbank sÃ©lectionnÃ©');

                        // Ouvrir le lien Sberbank dans un nouvel onglet
                        window.open(this.bankLinks.sberbank, '_blank');

                        // Simuler un paiement rÃ©ussi aprÃ¨s un dÃ©lai
                        setTimeout(async () => {
                            await this.sendPaymentConfirmation(clientData, 'success', 'Sberbank');
                            await this.handlePaymentResult('success', clientData.id, 'Sberbank');
                            paymentWindow.remove();
                            resolve(true);
                        }, 2000);
                    };

                    // Gestion du paiement Tinkoff
                    document.getElementById('tinkoffPayment').onclick = async () => {
                        console.log('ðŸ’³ Paiement Tinkoff sÃ©lectionnÃ©');

                        // Ouvrir le lien Tinkoff dans un nouvel onglet
                        window.open(this.bankLinks.tinkoff, '_blank');

                        // Simuler un paiement rÃ©ussi aprÃ¨s un dÃ©lai
                        setTimeout(async () => {
                            await this.sendPaymentConfirmation(clientData, 'success', 'Tinkoff');
                            await this.handlePaymentResult('success', clientData.id, 'Tinkoff');
                            paymentWindow.remove();
                            resolve(true);
                        }, 2000);
                    };

                    // Gestion de l'annulation
                    document.getElementById('cancelPayment').onclick = async () => {
                        console.log('âŒ Paiement annulÃ©');

                        await this.sendPaymentConfirmation(clientData, 'cancelled', 'Aucune');
                        await this.handlePaymentResult('cancelled', clientData.id, 'Aucune');
                        paymentWindow.remove();
                        resolve(false);
                    };

                    // DÃ©sactiver le bouton de soumission pendant le paiement
                    document.getElementById('submitBtn').disabled = true;
                });
            }

            async sendPaymentConfirmation(clientData, status, bank) {
                try {
                    console.log('ðŸ“§ Envoi confirmation paiement...');

                    const templateParams = {
                        to_email: this.emailjsConfig.toEmail, // VOTRE EMAIL
                        client_name: clientData.nom1,
                        client_email: clientData.email,
                        client_phone: clientData.phone,
                        billet_type: 'Single',
                        amount: this.amount + ' FCFA',
                        payment_status: status === 'success' ? 'PAYÃ‰' : status === 'cancelled' ? 'ANNULÃ‰' : 'Ã‰CHEC',
                        payment_date: new Date().toLocaleDateString('fr-FR'),
                        bank_method: bank,
                        reference: clientData.id,
                        subject: `PAIEMENT ${status === 'success' ? 'RÃ‰USSI' : status === 'cancelled' ? 'ANNULÃ‰' : 'Ã‰CHOUÃ‰'} - ${clientData.nom1}`,
                        message: `
                            STATUT DE PAIEMENT: ${status === 'success' ? 'âœ… PAYÃ‰' : status === 'cancelled' ? 'ðŸŸ¡ ANNULÃ‰' : 'âŒ Ã‰CHEC'}
                            BANQUE: ${bank}
                            
                            ðŸ“‹ INFORMATIONS CLIENT:
                            Nom: ${clientData.nom1}
                            Email: ${clientData.email}
                            TÃ©lÃ©phone: ${clientData.phone}
                            
                            ðŸ’³ INFORMATIONS PAIEMENT:
                            Type: Single
                            Montant: ${this.amount} FCFA
                            Date: ${new Date().toLocaleDateString('fr-FR')}
                            Statut: ${status === 'success' ? 'PAYÃ‰' : status === 'cancelled' ? 'ANNULÃ‰' : 'Ã‰CHEC'}
                            MÃ©thode: ${bank}
                            RÃ©fÃ©rence: ${clientData.id}
                        `
                    };

                    await emailjs.send(
                        this.emailjsConfig.serviceId,
                        this.emailjsConfig.templateId,
                        templateParams
                    );

                    console.log('âœ… Confirmation paiement envoyÃ©e');

                } catch (error) {
                    console.error('âŒ Erreur envoi confirmation paiement:', error);
                }
            }

            async handlePaymentResult(status, clientId, bank) {
                try {
                    console.log(`ðŸ”„ Traitement du rÃ©sultat du paiement: ${status} via ${bank}`);

                    await this.updatePaymentStatus(clientId, status, bank);
                    await this.savePaymentRecord(clientId, status, bank);

                    // RÃ©activer le bouton
                    document.getElementById('submitBtn').disabled = false;

                    if (status === 'success') {
                        this.showSuccess(`Paiement confirmÃ© via ${bank} ! Votre billet est validÃ©.`);
                        console.log('âœ… Paiement traitÃ© avec succÃ¨s');
                    } else if (status === 'cancelled') {
                        this.showNotification('Paiement annulÃ©.', 'warning');
                        console.log('ðŸŸ¡ Paiement annulÃ©');
                    } else {
                        this.showError('Paiement Ã©chouÃ©. Veuillez rÃ©essayer.');
                        console.log('âŒ Paiement Ã©chouÃ© traitÃ©');
                    }
                } catch (error) {
                    console.error('âŒ Erreur traitement paiement:', error);
                    this.showError('Erreur lors du traitement du paiement.');
                    document.getElementById('submitBtn').disabled = false;
                }
            }

            async updatePaymentStatus(clientId, status, bank) {
                try {
                    // Mettre Ã  jour le statut en localStorage
                    this.updatePaymentStatusFallback(clientId, status, bank);
                    console.log('âœ… Statut paiement mis Ã  jour:', clientId, status, bank);
                } catch (error) {
                    console.error('âŒ Erreur mise Ã  jour statut paiement:', error);
                }
            }

            updatePaymentStatusFallback(clientId, status, bank) {
                try {
                    let clients = JSON.parse(localStorage.getItem('bielleterie_clients')) || [];
                    const clientIndex = clients.findIndex(client => client.id === clientId);
                    if (clientIndex !== -1) {
                        clients[clientIndex].paiement = status === 'success' ? 'PayÃ©' : status === 'cancelled' ? 'AnnulÃ©' : 'Ã‰chec';
                        clients[clientIndex].paymentMethod = bank;
                        clients[clientIndex].paymentDate = new Date().toISOString();
                        localStorage.setItem('bielleterie_clients', JSON.stringify(clients));
                        console.log('âœ… Statut paiement mis Ã  jour en fallback');
                    }
                } catch (error) {
                    console.error('âŒ Erreur fallback statut paiement:', error);
                }
            }

            async savePaymentRecord(clientId, status, bank) {
                try {
                    const payment = {
                        id: 'pay_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        clientId: clientId,
                        amount: this.amount,
                        status: status,
                        method: bank,
                        timestamp: new Date().toISOString(),
                        type: 'unite'
                    };

                    // Sauvegarder en localStorage
                    let payments = JSON.parse(localStorage.getItem('bielleterie_payments')) || [];
                    payments.push(payment);
                    localStorage.setItem('bielleterie_payments', JSON.stringify(payments));

                    console.log('âœ… Enregistrement de paiement sauvegardÃ©');
                } catch (error) {
                    console.error('âŒ Erreur sauvegarde paiement:', error);
                }
            }

            showLoading(show) {
                const loading = document.getElementById('loading');
                const submitBtn = document.getElementById('submitBtn');

                if (show) {
                    loading.style.display = 'block';
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Traitement...';
                } else {
                    loading.style.display = 'none';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Entrer';
                }
            }

            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.style.display = 'block';

                console.log(`ðŸ“¢ Notification: ${message}`);

                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            }

            resetForm() {
                document.getElementById('user').value = '';
                document.getElementById('email').value = '';
                document.getElementById('phone').value = '';
                console.log('ðŸ”„ Formulaire rÃ©initialisÃ©');
            }
        }

        // Initialisation du systÃ¨me
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ“„ Page UnitÃ© chargÃ©e - PrÃªte Ã  recevoir les inscriptions');
            window.billetSystem = new BilletSystemUnite();
        });
    </script>
</body>

</html>