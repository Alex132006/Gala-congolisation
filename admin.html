<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Bielleterie</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            color: #ff6b6b;
        }

        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .logout-btn:hover {
            background: #ff3742;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #ff6b6b;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
        }

        .stat-trend {
            font-size: 0.8em;
            margin-top: 5px;
        }

        .trend-up {
            color: #4CAF50;
        }

        .trend-down {
            color: #ff4757;
        }

        .charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
        }

        .section {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #ff6b6b;
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .export-btn,
        .filter-btn,
        .action-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .filter-btn.active {
            background: #4CAF50;
        }

        .action-btn.warning {
            background: #ffa502;
        }

        .action-btn.danger {
            background: #ff4757;
        }

        .search-filter {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            margin-bottom: 10px;
        }

        .data-table {
            background: #2d2d2d;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        th {
            background: #3d3d3d;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #3d3d3d;
        }

        .type-couple {
            color: #ff6b6b;
        }

        .type-unite {
            color: #4CAF50;
        }

        .payment-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-success {
            background: #4CAF50;
            color: white;
        }

        .status-pending {
            background: #ffa502;
            color: black;
        }

        .status-failed {
            background: #ff4757;
            color: white;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 1000;
            display: none;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .export-option {
            background: #3d3d3d;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .export-option:hover {
            background: #4d4d4d;
        }

        @media (max-width: 768px) {
            .charts {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="notification" id="notification"></div>

    <div class="admin-container">
        <div class="header">
            <h1>ğŸ“Š Administration Bielleterie v2.0</h1>
            <div>
                <span id="lastUpdate"></span>
                <button class="logout-btn" onclick="logout()">ğŸšª DÃ©connexion</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalClients">0</div>
                <div>Total Clients</div>
                <div class="stat-trend" id="totalTrend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayClients">0</div>
                <div>Aujourd'hui</div>
                <div class="stat-trend" id="todayTrend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="coupleCount">0</div>
                <div>Couples</div>
                <div class="stat-trend" id="coupleTrend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniteCount">0</div>
                <div>UnitÃ©s</div>
                <div class="stat-trend" id="uniteTrend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="revenue">0</div>
                <div>Revenue (FCFA)</div>
                <div class="stat-trend" id="revenueTrend"></div>
            </div>
        </div>

        <div class="charts">
            <div class="chart-container">
                <canvas id="registrationsChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="typesChart"></canvas>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ¯ ContrÃ´les Rapides</h3>
            <div class="controls">
                <button class="export-btn" onclick="exportToExcel()">ğŸ“¥ Export Excel</button>
                <button class="export-btn" onclick="exportToPDF()">ğŸ“„ Export PDF</button>
                <button class="filter-btn active" onclick="filterClients('all')">Tous</button>
                <button class="filter-btn" onclick="filterClients('couple')">ğŸ‘« Couples</button>
                <button class="filter-btn" onclick="filterClients('unite')">ğŸ‘¤ UnitÃ©s</button>
                <button class="action-btn warning" onclick="sendBulkEmails()">ğŸ“§ Email GroupÃ©</button>
                <button class="action-btn" onclick="generatePromoCode()">ğŸ« CrÃ©er Code Promo</button>
                <button class="action-btn danger" onclick="clearAllData()">ğŸ—‘ï¸ Tout supprimer</button>
            </div>
        </div>

        <div class="search-filter">
            <input type="text" class="search-input" id="searchInput"
                placeholder="ğŸ” Rechercher par nom, email, tÃ©lÃ©phone...">
        </div>

        <div class="data-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Nom 1</th>
                        <th>Nom 2</th>
                        <th>Email</th>
                        <th>TÃ©lÃ©phone</th>
                        <th>Type</th>
                        <th>Paiement</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="clientsTable">
                    <tr>
                        <td colspan="8" class="no-data">Aucune donnÃ©e pour le moment</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h3>ğŸ’³ Gestion des Paiements</h3>
            <div class="controls">
                <button class="filter-btn" onclick="filterPayments('all')">Tous</button>
                <button class="filter-btn" onclick="filterPayments('success')">âœ… PayÃ©s</button>
                <button class="filter-btn" onclick="filterPayments('pending')">â³ En attente</button>
                <button class="filter-btn" onclick="filterPayments('failed')">âŒ Ã‰chouÃ©s</button>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Client</th>
                            <th>Montant</th>
                            <th>Statut</th>
                            <th>MÃ©thode</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTable">
                        <tr>
                            <td colspan="6" class="no-data">Aucun paiement enregistrÃ©</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”’ SÃ©curitÃ© & Maintenance</h3>
            <div class="controls">
                <button class="action-btn" onclick="createBackup()">ğŸ’¾ Sauvegarde</button>
                <button class="action-btn" onclick="restoreBackup()">ğŸ”„ Restaurer</button>
                <button class="action-btn warning" onclick="showAuditLog()">ğŸ“‹ Journal Audit</button>
                <button class="action-btn danger" onclick="toggleMaintenanceMode()">ğŸ› ï¸ Mode Maintenance</button>
            </div>
        </div>
    </div>

    <script>
        // VÃ©rification de sÃ©curitÃ©
        if (!localStorage.getItem('adminAuthenticated')) {
            window.location.href = 'admin-auth.html';
        }

        let clients = JSON.parse(localStorage.getItem('bielleterie_clients')) || [];
        let payments = JSON.parse(localStorage.getItem('bielleterie_payments')) || [];
        let currentFilter = 'all';
        let lastActivity = Date.now();
        let charts = {};

        // SÃ©curitÃ© : dÃ©connexion automatique aprÃ¨s 30 minutes
        setInterval(() => {
            if (Date.now() - lastActivity > 30 * 60 * 1000) {
                logout();
            }
        }, 60000);

        document.addEventListener('click', () => lastActivity = Date.now());

        function updateStats() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();

            const todayClients = clients.filter(client =>
                new Date(client.timestamp).toDateString() === today
            );

            const yesterdayClients = clients.filter(client =>
                new Date(client.timestamp).toDateString() === yesterday
            );

            const coupleClients = clients.filter(c => c.type === 'couple');
            const uniteClients = clients.filter(c => c.type === 'unite');

            const revenue = coupleClients.length * 5000 + uniteClients.length * 3000;
            const yesterdayRevenue = clients.filter(c =>
                new Date(c.timestamp).toDateString() === yesterday
            ).reduce((sum, client) => sum + (client.type === 'couple' ? 5000 : 3000), 0);

            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('todayClients').textContent = todayClients.length;
            document.getElementById('coupleCount').textContent = coupleClients.length;
            document.getElementById('uniteCount').textContent = uniteClients.length;
            document.getElementById('revenue').textContent = revenue.toLocaleString();

            updateTrend('totalTrend', clients.length, clients.length - 1);
            updateTrend('todayTrend', todayClients.length, yesterdayClients.length);
            updateTrend('coupleTrend', coupleClients.length, coupleClients.length - 1);
            updateTrend('uniteTrend', uniteClients.length, uniteClients.length - 1);
            updateTrend('revenueTrend', revenue, yesterdayRevenue);

            document.getElementById('lastUpdate').textContent = 'DerniÃ¨re mise Ã  jour: ' + new Date().toLocaleTimeString();
        }

        function updateTrend(elementId, current, previous) {
            const element = document.getElementById(elementId);
            if (previous === 0) {
                element.textContent = 'ğŸ†• Nouveau';
                element.className = 'stat-trend trend-up';
                return;
            }

            const change = ((current - previous) / previous * 100).toFixed(1);
            if (change > 0) {
                element.textContent = `ğŸ“ˆ +${change}%`;
                element.className = 'stat-trend trend-up';
            } else if (change < 0) {
                element.textContent = `ğŸ“‰ ${change}%`;
                element.className = 'stat-trend trend-down';
            } else {
                element.textContent = 'â¡ï¸ Stable';
                element.className = 'stat-trend';
            }
        }

        function initCharts() {
            const last7Days = getLast7Days();
            const dailyData = last7Days.map(day =>
                clients.filter(client =>
                    new Date(client.timestamp).toDateString() === day
                ).length
            );

            const ctx1 = document.getElementById('registrationsChart').getContext('2d');
            if (charts.registrations) charts.registrations.destroy();

            charts.registrations = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: last7Days.map(day => new Date(day).toLocaleDateString()),
                    datasets: [{
                        label: 'Inscriptions par jour',
                        data: dailyData,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'white' }
                        },
                        x: {
                            ticks: { color: 'white' }
                        }
                    }
                }
            });

            const ctx2 = document.getElementById('typesChart').getContext('2d');
            if (charts.types) charts.types.destroy();

            charts.types = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Couples', 'UnitÃ©s'],
                    datasets: [{
                        data: [
                            clients.filter(c => c.type === 'couple').length,
                            clients.filter(c => c.type === 'unite').length
                        ],
                        backgroundColor: ['#ff6b6b', '#4CAF50']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function getLast7Days() {
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date.toDateString());
            }
            return days;
        }

        function renderTable() {
            const tableBody = document.getElementById('clientsTable');
            const data = getFilteredClients();

            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="no-data">Aucune donnÃ©e pour le moment</td></tr>';
                return;
            }

            tableBody.innerHTML = data.map(client => {
                const paymentStatus = client.paymentStatus || 'pending';
                const statusClass = `status-${paymentStatus}`;
                const statusText = paymentStatus === 'success' ? 'âœ… PayÃ©' : paymentStatus === 'failed' ? 'âŒ Ã‰chouÃ©' : 'â³ En attente';

                return `
                    <tr>
                        <td>${new Date(client.timestamp).toLocaleString()}</td>
                        <td>${client.nom1}</td>
                        <td>${client.nom2 || '-'}</td>
                        <td>${client.email}</td>
                        <td>${client.phone}</td>
                        <td class="type-${client.type}">${client.type === 'couple' ? 'ğŸ‘« Couple' : 'ğŸ‘¤ UnitÃ©'}</td>
                        <td><span class="payment-status ${statusClass}">${statusText}</span></td>
                        <td>
                            <button onclick="viewClient('${client.id}')" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">ğŸ‘ï¸</button>
                            <button onclick="editClient('${client.id}')" style="background: #ffa502; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">âœï¸</button>
                            <button onclick="deleteClient('${client.id}')" style="background: #ff4757; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getFilteredClients() {
            switch (currentFilter) {
                case 'couple':
                    return clients.filter(c => c.type === 'couple');
                case 'unite':
                    return clients.filter(c => c.type === 'unite');
                default:
                    return clients;
            }
        }

        function filterClients(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderTable();
        }

        function exportToExcel() {
            if (clients.length === 0) {
                showNotification('Aucune donnÃ©e Ã  exporter', 'error');
                return;
            }

            let csv = 'Date,Nom1,Nom2,Email,TÃ©lÃ©phone,Type,Statut Paiement\n';
            clients.forEach(client => {
                csv += `"${new Date(client.timestamp).toLocaleString()}","${client.nom1}","${client.nom2 || ''}","${client.email}","${client.phone}","${client.type}","${client.paymentStatus || 'pending'}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `clients_bielleterie_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Export Excel rÃ©ussi !');
        }

        function exportToPDF() {
            showNotification('Fonction PDF Ã  implÃ©menter', 'warning');
        }

        function sendBulkEmails() {
            const emailList = clients.map(c => c.email).join(', ');
            const subject = encodeURIComponent('Bielleterie Ouverte - Information Importante');
            const body = encodeURIComponent(`Bonjour,

Informations importantes concernant votre inscription.

Cordialement,
L'Ã©quipe Bielleterie`);

            window.open(`mailto:${emailList}?subject=${subject}&body=${body}`);
        }

        function generatePromoCode() {
            const code = prompt('Entrez le nom du code promo:');
            const discount = prompt('Entrez le montant/percentage de rÃ©duction:');
            const type = confirm('Type de rÃ©duction? OK=Pourcentage, Annuler=Fixe') ? 'percentage' : 'fixed';

            if (code && discount) {
                let promoCodes = JSON.parse(localStorage.getItem('bielleterie_promocodes')) || {};
                promoCodes[code.toUpperCase()] = {
                    discount: parseFloat(discount),
                    type: type,
                    created: new Date().toISOString(),
                    uses: 0
                };

                localStorage.setItem('bielleterie_promocodes', JSON.stringify(promoCodes));
                showNotification(`Code promo ${code} crÃ©Ã© !`);
            }
        }

        function viewClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (client) {
                alert(`DÃ©tails client:\nNom: ${client.nom1}${client.nom2 ? ' & ' + client.nom2 : ''}\nEmail: ${client.email}\nTÃ©lÃ©phone: ${client.phone}\nType: ${client.type}\nInscription: ${new Date(client.timestamp).toLocaleString()}`);
            }
        }

        function editClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (client) {
                const newNom1 = prompt('Nouveau nom 1:', client.nom1);
                const newNom2 = prompt('Nouveau nom 2:', client.nom2 || '');
                const newEmail = prompt('Nouvel email:', client.email);
                const newPhone = prompt('Nouveau tÃ©lÃ©phone:', client.phone);

                if (newNom1 && newEmail && newPhone) {
                    client.nom1 = newNom1;
                    client.nom2 = newNom2;
                    client.email = newEmail;
                    client.phone = newPhone;
                    localStorage.setItem('bielleterie_clients', JSON.stringify(clients));
                    showNotification('Client modifiÃ© !');
                    renderTable();
                }
            }
        }

        function deleteClient(clientId) {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer ce client ?')) {
                clients = clients.filter(c => c.id !== clientId);
                localStorage.setItem('bielleterie_clients', JSON.stringify(clients));
                showNotification('Client supprimÃ© !');
                renderTable();
            }
        }

        function clearAllData() {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer TOUTES les donnÃ©es ? Cette action est irrÃ©versible.')) {
                localStorage.removeItem('bielleterie_clients');
                localStorage.removeItem('bielleterie_payments');
                localStorage.removeItem('bielleterie_promocodes');
                clients = [];
                payments = [];
                updateStats();
                renderTable();
                showNotification('Toutes les donnÃ©es ont Ã©tÃ© supprimÃ©es.');
            }
        }

        function createBackup() {
            const backup = {
                clients: clients,
                payments: payments,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_bielleterie_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('âœ… Sauvegarde crÃ©Ã©e !');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const backup = JSON.parse(event.target.result);
                        if (backup.clients) {
                            localStorage.setItem('bielleterie_clients', JSON.stringify(backup.clients));
                            clients = backup.clients;
                        }
                        if (backup.payments) {
                            localStorage.setItem('bielleterie_payments', JSON.stringify(backup.payments));
                            payments = backup.payments;
                        }
                        showNotification('âœ… DonnÃ©es restaurÃ©es !');
                        updateStats();
                        renderTable();
                    } catch (error) {
                        showNotification('âŒ Fichier de sauvegarde invalide', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function toggleMaintenanceMode() {
            const currentMode = localStorage.getItem('maintenance_mode') === 'true';
            if (!currentMode) {
                if (confirm('Activer le mode maintenance? Les inscriptions seront suspendues.')) {
                    localStorage.setItem('maintenance_mode', 'true');
                    showNotification('ğŸ”§ Mode maintenance activÃ©');
                }
            } else {
                localStorage.setItem('maintenance_mode', 'false');
                showNotification('âœ… Mode maintenance dÃ©sactivÃ©');
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.background = type === 'success' ? '#4CAF50' : type === 'warning' ? '#ffa502' : '#ff4757';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function logout() {
            localStorage.removeItem('adminAuthenticated');
            window.location.href = 'admin-auth.html';
        }

        // Recherche en temps rÃ©el
        document.getElementById('searchInput').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm) {
                const filtered = getFilteredClients().filter(client =>
                    client.nom1.toLowerCase().includes(searchTerm) ||
                    (client.nom2 && client.nom2.toLowerCase().includes(searchTerm)) ||
                    client.email.toLowerCase().includes(searchTerm) ||
                    client.phone.includes(searchTerm)
                );
                renderFilteredTable(filtered);
            } else {
                renderTable();
            }
        });

        function renderFilteredTable(filteredClients) {
            const tableBody = document.getElementById('clientsTable');
            if (filteredClients.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="no-data">Aucun rÃ©sultat trouvÃ©</td></tr>';
                return;
            }

            tableBody.innerHTML = filteredClients.map(client => {
                const paymentStatus = client.paymentStatus || 'pending';
                const statusClass = `status-${paymentStatus}`;
                const statusText = paymentStatus === 'success' ? 'âœ… PayÃ©' : paymentStatus === 'failed' ? 'âŒ Ã‰chouÃ©' : 'â³ En attente';

                return `
                    <tr>
                        <td>${new Date(client.timestamp).toLocaleString()}</td>
                        <td>${client.nom1}</td>
                        <td>${client.nom2 || '-'}</td>
                        <td>${client.email}</td>
                        <td>${client.phone}</td>
                        <td class="type-${client.type}">${client.type === 'couple' ? 'ğŸ‘« Couple' : 'ğŸ‘¤ UnitÃ©'}</td>
                        <td><span class="payment-status ${statusClass}">${statusText}</span></td>
                        <td>
                            <button onclick="viewClient('${client.id}')" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">ğŸ‘ï¸</button>
                            <button onclick="editClient('${client.id}')" style="background: #ffa502; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">âœï¸</button>
                            <button onclick="deleteClient('${client.id}')" style="background: #ff4757; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin: 2px;">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Initialisation
        updateStats();
        initCharts();
        renderTable();

        // Actualisation automatique
        setInterval(() => {
            clients = JSON.parse(localStorage.getItem('bielleterie_clients')) || [];
            payments = JSON.parse(localStorage.getItem('bielleterie_payments')) || [];
            updateStats();
            initCharts();
            renderTable();
        }, 5000);

    </script>
</body>

</html>